var MJPEGCANVAS=MJPEGCANVAS||{REVISION:"0.5.0-SNAPSHOT"};MJPEGCANVAS.MultiStreamViewer=function(t){var e=this,i=(t=t||{}).divID,a=t.width,h=t.height,n=t.host,s=t.port||8080,r=t.quality,o=t.topics,A=t.labels,d=t.defaultStream||0,l=o[d],c=t.backgroundColor||"#444",g=document.createElement("canvas");g.width=a,g.height=h;var v=g.getContext("2d"),w=document.createElement("div");w.style.display="none",document.getElementsByTagName("body")[0].appendChild(w);var m=new MJPEGCANVAS.Button({height:30}),p=m.width,u=new MJPEGCANVAS.Viewer({divID:i,width:a,height:h,host:n,port:s,quality:r,topic:l,overlay:g,backgroundColor:c});function E(){f&&(window.clearInterval(f),g.width=g.width,M=!1)}u.on("warning",function(t){e.emit("warning",t)}),u.on("change",function(t){l=t,e.emit("change",t)}),this.close=function(){null!=u&&null!==u.timer&&void 0!==u.timer&&(clearInterval(u.timer),u=null),w.remove()};var f=null,C=!1,M=!1;u.canvas.addEventListener("mousemove",function(t){E(),C||(M=!0,m.redraw(),v.drawImage(m.canvas,5,30),f=setInterval(function(){E()},2e3))},!1),u.canvas.addEventListener("click",function(t){if(M){for(var e=5,i=30,n=u.canvas;n&&!isNaN(n.offsetLeft)&&!isNaN(n.offsetTop);)e+=n.offsetLeft-n.scrollLeft,i+=n.offsetTop-n.scrollTop,n=n.offsetParent;var s=t.pageX-e,r=t.pageY-i;if(s<p+5&&s>5&&r<45&&r>5){C=!0,E();var d=document.createElement("form");d.setAttribute("class","col-3");var c=document.createElement("select");c.setAttribute("name","stream"),c.setAttribute("class","form-select form-select-sm streamer");for(var m=0;m<o.length;m++){var f=document.createElement("option");o[m]===l&&f.setAttribute("selected","selected"),f.setAttribute("value",o[m]),A?f.innerHTML=A[m]:f.innerHTML+=o[m],c.appendChild(f)}d.appendChild(c),w.appendChild(d),w.style.position="absolute",w.style.top=i+"px",w.style.left=e+"px",w.style.width=a+"px",w.style.display="block",g.width=g.width,v.globalAlpha=.44,v.beginPath(),v.rect(0,0,a,h),v.fillStyle="#adb5bd",v.fill(),v.globalAlpha=1,c.addEventListener("click",function(){var t=c.options[c.selectedIndex].value;t!==l&&(w.innerHTML="",w.style.display="none",C=!1,g.width=g.width,u.changeStream(t))},!1)}}},!1)},MJPEGCANVAS.MultiStreamViewer.prototype.__proto__=EventEmitter2.prototype,MJPEGCANVAS.Viewer=function(t){var e=this,i=(t=t||{}).divID;this.width=t.width,this.height=t.height,this.host=t.host,this.port=t.port||8080,this.quality=t.quality,this.refreshRate=t.refreshRate||10,this.interval=t.interval||30,this.invert=t.invert||!1,this.backgroundColor=t.backgroundColor||"#444";var a=t.topic,h=t.overlay;this.image=new Image;var n=new MJPEGCANVAS.ErrorIcon;this.canvas=document.createElement("canvas"),this.canvas.width=this.width,this.canvas.height=this.height,this.canvas.style.background=this.backgroundColor,document.getElementById(i).appendChild(this.canvas);var s=this.canvas.getContext("2d"),r=Math.max(1/this.refreshRate*1e3,this.interval);this.changeStream(a),this.timer=setInterval(function(){if(e.canvas.width=e.canvas.width,e.image.width*e.image.height>0)s.drawImage(e.image,0,0,e.width,e.height);else{var t=80<e.canvas.width?(e.canvas.width-80)/2:0,i=80<e.canvas.height?(e.canvas.height-80)/2:0;s.drawImage(n.image,t,i,80,80),e.emit("warning","Invalid stream.")}if(h&&s.drawImage(h,0,0),navigator.userAgent.toLowerCase().indexOf("firefox")>-1){var a=e.image.src.split("?killcache=");e.image.src=a[0]+"?killcache="+Math.random(42)}},r)},MJPEGCANVAS.Viewer.prototype.__proto__=EventEmitter2.prototype,MJPEGCANVAS.Viewer.prototype.changeStream=function(t){this.image=new Image;var e="http://"+this.host+":"+this.port+"/stream?topic="+t;e+="&type=ros_compressed",e+="&width="+this.width,e+="&height="+this.height,this.quality>0&&(e+="&quality="+this.quality),this.invert&&(e+="&invert="+this.invert),this.image.src=e,this.emit("change",t)},MJPEGCANVAS.Button=function(t){t=t||{},this.height=t.height,this.canvas=document.createElement("canvas"),this.redraw()},MJPEGCANVAS.Button.prototype.redraw=function(){var t=this.canvas.getContext("2d");this.width=this.height,this.canvas.width=this.width,this.canvas.height=this.height;var e=new Image;e.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGAAAABgCAQAAABIkb+zAAAEGklEQVR42u3cTUhUURTA8TOMaYbZxyKjdhEIaasnQrUoMzeuok1hZLSwTSgZBAnRgNWiFq0LaysIEiGCiyyiVVQUBhJBUUZEGbRJrZT4tyiM7r3vzXs2070nOrP0vOP7MTPvfrzzRqSEwTKaOMApLjPGU17+fH1gigeMco0CR9hKTkILqmmhwDizpIlP3OUSe1kRDqCdL2SPOa5ziFWaCQBfucEu3QSAx3RSqZsAbzlGhW4CTLJHOwFG2Bwi4TD7Oc0gz1IQZjkaHiFa/Ps69jHAdBHEMKvDIkRGTp7dXGUugfCKHSERImfeWk7yOpYwz8FwCFFsZiXdsR+ob/SGQogSc2vo52sM4kIYhKhodiP3YggDIRCiFNl5+lhwEs76J0Qp81t45yR0+SZEqfM38sgBWKDdLyHKkF/LHQdhhkafhIZM+csZcRAmqBItQRW3HYSLoidYyUPHwLZTE6GON44ZUq0mwnbH+Hy+nP+wUHSuX8hYscexWtjg7/QzE8gxblW44vP0sxM2MWMNavU+Tz874YR1/NDST7TMEbPn+sJa6qxXBBChw0rs0wXIMWEkPl/iLrcfgAiHrdRWXYAq3hupg6oAIpwzUj+S1wWot5KbVQFEeFKCK5FXwBkj+ZY2QJOR/JlqXYAKPhnp21QBRLhppHeWDzBJL1uooYYt9DJZIkC/kd5fHsA83b9fo8nTzXwJAB1/PJilunHa5jyyLXb7Nj2g2Ui/Xw5AT4blYVbAGnM0Lj1gMn6AJ1/8u1D+fYJicTzx6OPhAxK3EGkIH7CyyG7bf8D/j9C//iX+25dRPhoV1oQ8kLmK3s+2TPM7lXCVHTQqdIQ8mSvBBNXvdNp1Qp1GhZshL2hcJ7TN6uqs0AWo5rNRo0kVQIRbRo0z2gB9Ro0n2gDNVpV6XYC8NRqfUwVwDGbv43sSwgS02l2eugA5nlt9ITlFAMeVKHZOFCpgvTXVesEyRQARhqxaJ0RTUG/1C86wSRfhivUejAf4xFECYIPjKaQeXe/BecfycLsmQC2vLMIb6jQRdvLNIjxM3m0LjXDRcXG+ratfc8JBGGF5pioNPhuFG60WL4A7Wdodifjit9fZ1QT/iI0ZAPgldDknKu9oyQDwTDjrJCzQl6bJ5SfAM2EgZsJ4r3gb/CLAM+FC7PZtPzUpAZ4JvY6B7UdM0x3/AO1vAM+Egwm7yq85ydoUAM+EHY4Z0q+Y4yq7zS+2BfBMWM1wkZXgNAPsY10CwC9BhKOpfrPgGYOcZr+jyzMAwmbngznZwi9BhD3p77WESqjgGG9VE0SopJPHqgkiIuziRpobpwETRFjFIa4nPlgeOkFEhBXs5RJ3ra5Od8wyToGWJTStlh2SYytHKHCNUR4wxYfFn+h5yhiXOcUBmtx7rkuN70PAcoouKzccAAAAAElFTkSuQmCC",t.drawImage(e,0,0,this.width,this.height)},MJPEGCANVAS.ErrorIcon=function(){this.image=new Image,this.image.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGAAAABgCAQAAABIkb+zAAACSElEQVR42u2bvU4CQRCApRCxNNqRWPoYWBEKSfQtaDDhSS4GWt7BltD6AhcwVhgs1MbEn85GPwuNkWi8PXdnb2fd7wHIfGR3bnZ3Zm0tkUgkEglnsE2HY4ZMuGDJLQC3LLlgwpBjOmyHGXiDLhk5JuRkdGmEE/w+Y54oyxNj9qsOvU6PBTYs6FGvatEMuMEFNwy8LygOuMQllxz4C36XUyQ4ZddH+Ic8IMUDh7LBr3OCNCesS4W/xRk+OGNLIvwm5/jinKbr8Pe4widX7Ln99/2G/67QdLf251TB3MleoO5p6/68ne3LDA+J89ekahv+Ea+VCrxyZFc03FM19xYFhlDNU7pG+nvFGQp/qVTZtCuYv/2eXbG9WV5gYPenORWAQdnwN7gOSuCajXICPdtl61gAemXCr1ke1SUEFtTMBVr2icO5ALTMBcZBCozNE+hjkAKPhsmUrotvj4AAdM0EsmAFMjOBPFiB3CT8HV6CFXhhp1ig7ab+EhGAdrFAP2iBfrHAKGiBUbHANGiBabHALGiBWbHAMmiBZbHAXdACd8UCz0ELPP8DAfVLSP0mVp9GHX3IhJh6KyWEGHkr5oToeyunhWh7O9CIYHKgcXWkFCH3eKgXIfN4rSKC4bWK9ost9VeLMVzuar9eV//AEcETk/pHvgieWdU/dEfQahBBs4f6dpsIGp4iaDlT3/QXQdtlBI2vEbQeR9D8HUH7fQQDEFGMoEQwBPShoHsM67PM0DsI90VD7yjiyoLSOwy6IqJ1HDeRSCQSSnkDkLafSPJMgbsAAAAASUVORK5CYII="};